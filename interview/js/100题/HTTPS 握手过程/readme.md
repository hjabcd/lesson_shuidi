 ![](https://camo.githubusercontent.com/63f1ee6d5780cf6e7123407ffd00c85e3cb469e1/68747470733a2f2f7777772e7275616e796966656e672e636f6d2f626c6f67696d672f61737365742f3230313430322f6267323031343032303530332e676966)
 >1
 1. 客户端发出请求（ClientHello）： 客户端向服务端发起加密通信的请求
 2. 服务器回应（SeverHello）： 服务器收到客户端请求后，确认加密通信协议版本是否一致，如果版本一致则返回服务器证书，否则关闭加密通信
 3. 客户端回应：客户端收到服务器回应后，客户端首先验证证书是否有效。如果证书失效，则会给访问者一个警示，由其决定是否继续连接。如果证书没失效，则使用证书中的公钥加密一个随机数(pre-master key)返回给服务器，同时返回客户端握手结束通知。
 4. 服务器的最后回应：服务器收到客户端发来的pre-master key后，计算生成本次会话的“会话密钥”，向客户端发送服务器握手结束通知。
 
 至此， 整个握手阶段结束。接下来，客户端与服务器进入加密通信。

> 2
 1. 浏览器 发送随机数 random1 + 支持的加密算法列表 到服务器
 2. 服务器 发送随机数 random2 + 选择的加密算法 + 数字证书（公钥在证书里） + 确认信息
 3. 浏览器 验证证书有效性
 4. 浏览器 生成一个随机数 pre-master，**采用非对称加密**通过服务器的公钥加密发送给服务器，同时根据加密算法将 random1 + random2 + pre-master 生成 master-secret 用于后续数据传输
 5. 服务器 用私钥解密得到 pre-master，根据算法将 random1 + random2 + pre-master 生成 master-secret用于数据传输
 6. **对称加密**，浏览器和服务器之间使用 master-secret 加密的数据进行通信



[https握手过程](https://developers.weixin.qq.com/community/develop/article/doc/000046a5fdc7802a15f7508b556413)


# HTTPS 握手过程中，客户端如何验证证书的合法性

 （1）首先浏览器读取证书中的证书所有者、有效期等信息进行校验，校验证书的网站域名是否与证书颁发的域名一致，校验证书是否在有效期内
 
 （2）浏览器开始查找操作系统中已内置的受信任的证书发布机构CA，与服务器发来的证书中的颁发者CA比对，用于校验证书是否为合法机构颁发
 
 （3）如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的。
 
 （4）如果找到，那么浏览器就会从操作系统中取出颁发者CA 的公钥(多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥)，然后对服务器发来的证书里面的签名进行解密
 
 （5）浏览器使用相同的hash算法计算出服务器发来的证书的hash值，将这个计算的hash值与证书中签名做对比
 （6）对比结果一致，则证明服务器发来的证书合法，没有被冒充

